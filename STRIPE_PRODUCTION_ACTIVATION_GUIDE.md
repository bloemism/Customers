# Stripe本番環境 有効化ガイド

## 現在の状況

✅ **テストモード**: 完全に動作中  
❌ **本番モード**: 審査・承認が必要

---

## 本番環境の有効化手順

### ステップ1: アカウント情報の完成

Stripeダッシュボードで必要な情報を入力します。

#### アクセス先
https://dashboard.stripe.com/settings/account

#### 必要な情報

1. **ビジネス情報**
   - 事業者名（正式名称）
   - 事業種別（個人事業主 or 法人）
   - 事業内容の説明
   - ウェブサイトURL
   - サポートメールアドレス
   - サポート電話番号

2. **代表者情報**
   - 氏名
   - 生年月日
   - 住所
   - 電話番号
   - メールアドレス

3. **銀行口座情報**
   - 銀行名
   - 支店名
   - 口座種別（普通 or 当座）
   - 口座番号
   - 口座名義

4. **本人確認書類**
   - 運転免許証
   - パスポート
   - マイナンバーカード
   のいずれか（写真アップロード）

5. **事業証明書類**（法人の場合）
   - 登記簿謄本
   - 印鑑証明書

---

### ステップ2: 本人確認の完了

#### 手順

1. **Stripeダッシュボードにログイン**
   https://dashboard.stripe.com/

2. **バナーまたは通知を確認**
   - 「アカウント情報を完成させてください」
   - 「本人確認が必要です」
   などのメッセージが表示されます

3. **指示に従って情報を入力**
   - 各フィールドを正確に入力
   - 必要書類をアップロード

4. **送信**
   - すべての情報を確認
   - 「Submit for review」をクリック

---

### ステップ3: 審査

#### 審査期間
- **通常**: 1〜3営業日
- **追加情報が必要な場合**: 1週間程度

#### 審査中にできること
- テストモードでの開発継続
- 機能の追加・改善
- ドキュメント作成

#### 審査の進捗確認
- Stripeから**メール通知**が届きます
- ダッシュボードでステータス確認可能

---

### ステップ4: 承認後の設定

#### 承認されたら

1. **Stripeダッシュボードで確認**
   - 右上が「Test mode」と「Live mode」を切り替え可能になります
   - 「Live mode」に切り替え

2. **本番用APIキーを取得**
   - https://dashboard.stripe.com/apikeys
   - **Publishable key**: `pk_live_...`
   - **Secret key**: `sk_live_...`

3. **Vercelの環境変数を更新**
   https://vercel.com/bloemisms-projects/customers/settings/environment-variables
   
   - `VITE_STRIPE_PUBLISHABLE_KEY`: `pk_live_...`に変更
   - `STRIPE_SECRET_KEY`: `sk_live_...`に変更

4. **再デプロイ**
   ```bash
   cd /Users/user/customers && vercel --prod
   ```

5. **本番環境でテスト**
   - **実際のカード**を使用
   - 少額（100円など）でテスト
   - 決済が成功することを確認

---

## 日本でのStripe本番環境有効化のポイント

### 必須要件

1. **日本国内の銀行口座**
   - ゆうちょ銀行は非対応
   - メガバンク、地方銀行、ネット銀行が推奨

2. **正確な事業情報**
   - 事業内容が明確に記載されていること
   - 「花屋・フラワースクール向け決済プラットフォーム」

3. **本人確認書類**
   - 鮮明な写真
   - 有効期限内
   - 四隅がすべて写っている

4. **事業の実態**
   - ウェブサイトが稼働中
   - サポート体制が整っている
   - 利用規約・プライバシーポリシーが整備されている

---

## よくある質問

### Q1: 審査に落ちることはありますか？

A: 以下の場合、審査が通らない可能性があります：
- 事業内容が不明確
- 本人確認書類が不鮮明
- 禁止業種（ギャンブル、アダルトなど）
- 銀行口座情報が間違っている

**対策**: 正確な情報を入力し、不明点はStripeサポートに問い合わせ

### Q2: 追加情報を求められたら？

A: Stripeからメールで連絡が来ます
- 速やかに対応
- 必要な書類を追加提出
- サポートに質問があれば連絡

### Q3: テストモードと本番モードの切り替えは？

A: いつでも切り替え可能
- ダッシュボード右上のトグルスイッチ
- テストモードで開発を継続可能

### Q4: 手数料はいくらですか？

A: 日本国内の場合
- **決済手数料**: 3.6%
- **固定費**: なし（JPYの場合）
- **入金手数料**: 無料
- **入金サイクル**: 週次（金曜日）

---

## 本番環境での注意点

### セキュリティ

1. **本番APIキーの管理**
   - `.env`ファイルに保存
   - Gitにコミットしない（`.gitignore`に追加済み）
   - 環境変数はVercelで管理

2. **Webhook設定**
   - 本番用Webhook URLを設定
   - Webhook署名シークレットを更新

3. **エラーハンドリング**
   - 本番環境では詳細なエラーログを残す
   - ユーザーには簡潔なメッセージを表示

### テスト

1. **本番環境で少額テスト**
   - 100円などの少額で決済テスト
   - 返金機能のテスト
   - エラーハンドリングのテスト

2. **実際のカードでテスト**
   - 3Dセキュア対応カードでテスト
   - 決済失敗時の挙動確認
   - メール通知の確認

---

## Connected Accounts（Stripe Connect）について

### テストモード
✅ **即座に使用可能**
- Connected Accountを自由に作成
- 分割決済のテスト
- オンボーディングフローのテスト

### 本番モード
❌ **別途申請が必要**

#### Stripe Connect申請手順

1. **Stripe Dashboardにアクセス**
   https://dashboard.stripe.com/settings/connect

2. **「Get started」をクリック**

3. **プラットフォーム情報を入力**
   - プラットフォーム名: `Bloemism 87app`
   - プラットフォームタイプ: `Marketplace`
   - 説明: `花屋・フラワースクール向け決済プラットフォーム。店舗と顧客をつなぐオンライン決済サービス`
   - ウェブサイト: デプロイサイトのURL
   - サポートメール: サポート用メールアドレス

4. **利用目的を説明**
   - 「店舗が顧客から決済を受け付けるため」
   - 「プラットフォーム手数料を差し引いて店舗に入金」
   - 「花屋・フラワースクール業界に特化」

5. **審査**
   - 通常1〜2週間
   - ビジネスモデルの詳細説明が必要な場合あり

6. **承認後**
   - 本番環境でConnected Accounts使用可能
   - 店舗のオンボーディングが可能

---

## 現在の実装状況

### ✅ 完成している機能（テストモードで動作確認済み）

1. **決済コードシステム**
   - 5桁コード生成
   - コード入力
   - データ連携

2. **Stripe決済統合**
   - Payment Linkへのリダイレクト
   - メール・決済コードの引き継ぎ
   - 決済完了フロー

3. **顧客管理**
   - ログイン・新規登録
   - プロフィール管理
   - ポイントシステム

### ⏸️ 本番環境承認待ち

1. **Stripe Connect**
   - Connected Account作成
   - 店舗オンボーディング
   - 分割決済

---

## 推奨アクション

### 今すぐできること

1. ✅ **テストモードで完全にテスト**
   - すべての決済フローを確認
   - エラーケースをテスト
   - UIの改善

2. ✅ **Stripeアカウント情報を完成**
   - ビジネス情報入力
   - 本人確認書類アップロード
   - 銀行口座情報入力

3. ✅ **ドキュメント整備**
   - 利用規約
   - プライバシーポリシー
   - 特定商取引法に基づく表記

### 本番環境承認後

1. ✅ **環境変数を本番キーに切り替え**
2. ✅ **少額で本番テスト**
3. ✅ **本格運用開始**

---

## サポート

### Stripe日本サポート

- **メール**: jp-support@stripe.com
- **チャット**: ダッシュボード右下のチャットアイコン
- **ドキュメント**: https://stripe.com/docs
- **日本語ガイド**: https://stripe.com/jp/guides

### よくある質問

**Q: 審査はどのくらいかかりますか？**  
A: 通常1〜3営業日。書類に不備がなければ早い。

**Q: 個人事業主でも申請できますか？**  
A: はい、可能です。開業届の提出は必須ではありません。

**Q: Connected Accountsは必須ですか？**  
A: いいえ。まずは通常の決済のみで本番環境を有効化し、その後Connected Accountsを申請できます。

---

## まとめ

### 現時点での状態

✅ **決済システム完成**: テストモードで完全動作  
✅ **セキュリティ**: カード情報はStripeが管理  
⏳ **本番環境**: アカウント情報入力→審査→承認待ち  

### 次のステップ

1. **今日**: Stripeアカウント情報を完成させる
2. **1〜3日後**: 審査完了
3. **承認後**: 環境変数を本番キーに切り替え
4. **運用開始**: 実際の決済受付開始

---

**Stripeダッシュボードでアカウント情報を完成させてください！**

https://dashboard.stripe.com/settings/account

すべての項目を入力すれば、数日で本番環境が使えるようになります。🚀

